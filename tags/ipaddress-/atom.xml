<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag:ipaddress, | Ashwani's Tech World - Giving back to community]]></title>
  <link href="http://blog.ashwani.co.in/tags/ipaddress-/atom.xml" rel="self"/>
  <link href="http://blog.ashwani.co.in/"/>
  <updated>2020-10-30T22:50:03+00:00</updated>
  <id>http://blog.ashwani.co.in/</id>
  <author>
    <name><![CDATA[Ashwani Kumar]]></name>
    <email><![CDATA[aryan.ashwani@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[IP Address GeoCoding and Plotting on map]]></title>
    <link href="http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map/"/>
    <updated>2016-01-23T21:49:37+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map</id>
    <content type="html"><![CDATA[<p>Sometimes back I had setup ssh on raspberry pi and allowed to login from internet, obviously using the public key encyption.
After few days I noticed that lot of people/systems were trying to login and failing from various different IPs.
So I block them using Fail2ban. I am Not gonna talk about Fail2ban, as its completely vast topic on its own.</p>

<!--more-->


<p><a href="http://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a> : It provides a way to automatically protect virtual servers from malicious behavior.
The program works by scanning through log files and reacting to offending actions such as repeated failed login attempts.</p>

<p>Once blocked I wanted to see from where I was getting attacked the most. So I plotted them on map using some free apis.
Here is my fail2ban config for creating a file of all blocked IP addresses.</p>

<p>{% codeblock %}
/pathToFail2ban/action.d/iptables-multiport.conf</p>

<p>[Definition]</p>

<h1>Option:  actionstart</h1>

<h1>Notes.:  command executed once at the start of Fail2Ban.</h1>

<h1>Values:  CMD</h1>

<p>#</p>

<p>actionstart = iptables -N fail2ban-<name>
              iptables -A fail2ban-<name> -j RETURN
              iptables -I <chain> -p <protocol> -m multiport --dports <port> -j fail2ban-<name>
              cat /etc/fail2ban/ip.blacklist.persistban.<name> | while read IP; do iptables -I fail2ban-<name> 1 -s $IP -j DROP; done</p>

<h1>Option:  actionban</h1>

<h1>Notes.:  command executed when banning an IP. Take care that the</h1>

<h1>command is executed with Fail2Ban user rights.</h1>

<h1>Tags:    <ip>  IP address</h1>

<h1><failures>  number of failures</h1>

<h1><time>  unix timestamp of the ban time</h1>

<h1>Values:  CMD</h1>

<p>#
actionban = iptables -I fail2ban-<name> 1 -s <ip> -j DROP
            echo <ip> >> /etc/fail2ban/ip.blacklist.persistban.<name>
            echo <ip> >> /pathToMysite/blocked_ipaddresses.txt
{% endcodeblock %}</p>

<p>I used <a href="http://lab.abhinayrathore.com/ipmapper/">ipmapper</a> which uses google maps api for geocoding.</p>

<p>Here is my html code to plot those blocked IPs.</p>

<p>{% codeblock %}
<html>
<head></p>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>


<pre><code>&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="ipmapper.js"&gt;&lt;/script&gt;
&lt;meta name="viewport" content="initial-scale=1.0, user-scalable=no" /&gt;
&lt;style&gt;
  html, body, #map {
    height: 100%;
    margin: 0px;
    padding: 0px;
  }
&lt;/style&gt;
&lt;script type="text/javascript"&gt;
$(function(){
    try{
            var useragent = navigator.userAgent;
            var mapdiv = document.getElementById("map");
            console.log(useragent.indexOf('iPhone'));
            if (useragent.indexOf('iPhone') == -1 || useragent.indexOf('Android') == -1 ) {
                    mapdiv.style.width = '100%';
                    mapdiv.style.height = '100%';
            } else {
                    mapdiv.style.width = '600px';
                    mapdiv.style.height = '800px';
            }

            IPMapper.initializeMap("map");

            var file = "../data/blocked_ipaddresses.txt";
            var ipArray = new Array();
            $.get(file, function(data){
                    ipArray = data.split('\n');
                    //console.log("Raw array length is -" + ipArray.length);
                    IPMapper.addIPArray(ipArray);
            });

    } catch(e){
        //handle error
    }
});
&lt;/script&gt;
</code></pre>

<p></head>
<body>
    <div id="map" style="height: 800px;"></div>
</body>
</html>
{% endcodeblock %}</p>

<p>Here is the output plotted on the map... :)</p>

<p><img src="/images/bot_attacks_on_pi.jpg" title="Bot attack image - not able to load pic." alt="alt " /></p>

<p>hmm.. lot of friendly visits from China and Russia... :)</p>

<p>Chow...</p>

<p><br/></p>
]]></content>
  </entry>
  
</feed>
