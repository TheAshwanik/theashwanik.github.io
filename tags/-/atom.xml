<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag:, | Ashwani's Tech World - Giving back to community]]></title>
  <link href="http://blog.ashwani.co.in/tags/-/atom.xml" rel="self"/>
  <link href="http://blog.ashwani.co.in/"/>
  <updated>2020-10-30T22:50:03+00:00</updated>
  <id>http://blog.ashwani.co.in/</id>
  <author>
    <name><![CDATA[Ashwani Kumar]]></name>
    <email><![CDATA[aryan.ashwani@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[IP Address GeoCoding and Plotting on map]]></title>
    <link href="http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map/"/>
    <updated>2016-01-23T21:49:37+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map</id>
    <content type="html"><![CDATA[<p>Sometimes back I had setup ssh on raspberry pi and allowed to login from internet, obviously using the public key encyption.
After few days I noticed that lot of people/systems were trying to login and failing from various different IPs.
So I block them using Fail2ban. I am Not gonna talk about Fail2ban, as its completely vast topic on its own.</p>

<!--more-->


<p><a href="http://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a> : It provides a way to automatically protect virtual servers from malicious behavior.
The program works by scanning through log files and reacting to offending actions such as repeated failed login attempts.</p>

<p>Once blocked I wanted to see from where I was getting attacked the most. So I plotted them on map using some free apis.
Here is my fail2ban config for creating a file of all blocked IP addresses.</p>

<p>{% codeblock %}
/pathToFail2ban/action.d/iptables-multiport.conf</p>

<p>[Definition]</p>

<h1>Option:  actionstart</h1>

<h1>Notes.:  command executed once at the start of Fail2Ban.</h1>

<h1>Values:  CMD</h1>

<p>#</p>

<p>actionstart = iptables -N fail2ban-<name>
              iptables -A fail2ban-<name> -j RETURN
              iptables -I <chain> -p <protocol> -m multiport --dports <port> -j fail2ban-<name>
              cat /etc/fail2ban/ip.blacklist.persistban.<name> | while read IP; do iptables -I fail2ban-<name> 1 -s $IP -j DROP; done</p>

<h1>Option:  actionban</h1>

<h1>Notes.:  command executed when banning an IP. Take care that the</h1>

<h1>command is executed with Fail2Ban user rights.</h1>

<h1>Tags:    <ip>  IP address</h1>

<h1><failures>  number of failures</h1>

<h1><time>  unix timestamp of the ban time</h1>

<h1>Values:  CMD</h1>

<p>#
actionban = iptables -I fail2ban-<name> 1 -s <ip> -j DROP
            echo <ip> >> /etc/fail2ban/ip.blacklist.persistban.<name>
            echo <ip> >> /pathToMysite/blocked_ipaddresses.txt
{% endcodeblock %}</p>

<p>I used <a href="http://lab.abhinayrathore.com/ipmapper/">ipmapper</a> which uses google maps api for geocoding.</p>

<p>Here is my html code to plot those blocked IPs.</p>

<p>{% codeblock %}
<html>
<head></p>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>


<pre><code>&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="ipmapper.js"&gt;&lt;/script&gt;
&lt;meta name="viewport" content="initial-scale=1.0, user-scalable=no" /&gt;
&lt;style&gt;
  html, body, #map {
    height: 100%;
    margin: 0px;
    padding: 0px;
  }
&lt;/style&gt;
&lt;script type="text/javascript"&gt;
$(function(){
    try{
            var useragent = navigator.userAgent;
            var mapdiv = document.getElementById("map");
            console.log(useragent.indexOf('iPhone'));
            if (useragent.indexOf('iPhone') == -1 || useragent.indexOf('Android') == -1 ) {
                    mapdiv.style.width = '100%';
                    mapdiv.style.height = '100%';
            } else {
                    mapdiv.style.width = '600px';
                    mapdiv.style.height = '800px';
            }

            IPMapper.initializeMap("map");

            var file = "../data/blocked_ipaddresses.txt";
            var ipArray = new Array();
            $.get(file, function(data){
                    ipArray = data.split('\n');
                    //console.log("Raw array length is -" + ipArray.length);
                    IPMapper.addIPArray(ipArray);
            });

    } catch(e){
        //handle error
    }
});
&lt;/script&gt;
</code></pre>

<p></head>
<body>
    <div id="map" style="height: 800px;"></div>
</body>
</html>
{% endcodeblock %}</p>

<p>Here is the output plotted on the map... :)</p>

<p><img src="/images/bot_attacks_on_pi.jpg" title="Bot attack image - not able to load pic." alt="alt " /></p>

<p>hmm.. lot of friendly visits from China and Russia... :)</p>

<p>Chow...</p>

<p><br/></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[IP Address GeoCoding and Plotting on map]]></title>
    <link href="http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map/"/>
    <updated>2016-01-23T21:49:37+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2016-01-23/ip-address-geocoding-and-plotting-on-map</id>
    <content type="html"><![CDATA[<p>Sometimes back I had setup ssh on raspberry pi and allowed to login from internet, obviously using the public key encyption.
After few days I noticed that lot of people/systems were trying to login and failing from various different IPs.
So I block them using Fail2ban. I am Not gonna talk about Fail2ban, as its completely vast topic on its own.</p>

<!--more-->


<p><a href="http://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a> : It provides a way to automatically protect virtual servers from malicious behavior.
The program works by scanning through log files and reacting to offending actions such as repeated failed login attempts.</p>

<p>Once blocked I wanted to see from where I was getting attacked the most. So I plotted them on map using some free apis.
Here is my fail2ban config for creating a file of all blocked IP addresses.</p>

<p>{% codeblock %}
/pathToFail2ban/action.d/iptables-multiport.conf</p>

<p>[Definition]</p>

<h1>Option:  actionstart</h1>

<h1>Notes.:  command executed once at the start of Fail2Ban.</h1>

<h1>Values:  CMD</h1>

<p>#</p>

<p>actionstart = iptables -N fail2ban-<name>
              iptables -A fail2ban-<name> -j RETURN
              iptables -I <chain> -p <protocol> -m multiport --dports <port> -j fail2ban-<name>
              cat /etc/fail2ban/ip.blacklist.persistban.<name> | while read IP; do iptables -I fail2ban-<name> 1 -s $IP -j DROP; done</p>

<h1>Option:  actionban</h1>

<h1>Notes.:  command executed when banning an IP. Take care that the</h1>

<h1>command is executed with Fail2Ban user rights.</h1>

<h1>Tags:    <ip>  IP address</h1>

<h1><failures>  number of failures</h1>

<h1><time>  unix timestamp of the ban time</h1>

<h1>Values:  CMD</h1>

<p>#
actionban = iptables -I fail2ban-<name> 1 -s <ip> -j DROP
            echo <ip> >> /etc/fail2ban/ip.blacklist.persistban.<name>
            echo <ip> >> /pathToMysite/blocked_ipaddresses.txt
{% endcodeblock %}</p>

<p>I used <a href="http://lab.abhinayrathore.com/ipmapper/">ipmapper</a> which uses google maps api for geocoding.</p>

<p>Here is my html code to plot those blocked IPs.</p>

<p>{% codeblock %}
<html>
<head></p>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>


<pre><code>&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="ipmapper.js"&gt;&lt;/script&gt;
&lt;meta name="viewport" content="initial-scale=1.0, user-scalable=no" /&gt;
&lt;style&gt;
  html, body, #map {
    height: 100%;
    margin: 0px;
    padding: 0px;
  }
&lt;/style&gt;
&lt;script type="text/javascript"&gt;
$(function(){
    try{
            var useragent = navigator.userAgent;
            var mapdiv = document.getElementById("map");
            console.log(useragent.indexOf('iPhone'));
            if (useragent.indexOf('iPhone') == -1 || useragent.indexOf('Android') == -1 ) {
                    mapdiv.style.width = '100%';
                    mapdiv.style.height = '100%';
            } else {
                    mapdiv.style.width = '600px';
                    mapdiv.style.height = '800px';
            }

            IPMapper.initializeMap("map");

            var file = "../data/blocked_ipaddresses.txt";
            var ipArray = new Array();
            $.get(file, function(data){
                    ipArray = data.split('\n');
                    //console.log("Raw array length is -" + ipArray.length);
                    IPMapper.addIPArray(ipArray);
            });

    } catch(e){
        //handle error
    }
});
&lt;/script&gt;
</code></pre>

<p></head>
<body>
    <div id="map" style="height: 800px;"></div>
</body>
</html>
{% endcodeblock %}</p>

<p>Here is the output plotted on the map... :)</p>

<p><img src="/images/bot_attacks_on_pi.jpg" title="Bot attack image - not able to load pic." alt="alt " /></p>

<p>hmm.. lot of friendly visits from China and Russia... :)</p>

<p>Chow...</p>

<p><br/></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up octopress blog once you lost the working env]]></title>
    <link href="http://blog.ashwani.co.in/blog/2016-01-17/setting-up-octopress-blog-once-you-lost-the-working-env/"/>
    <updated>2016-01-17T10:01:28+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2016-01-17/setting-up-octopress-blog-once-you-lost-the-working-env</id>
    <content type="html"><![CDATA[<p>Hi Guys,</p>

<p>So recently I wanted to revisit my blog after a long long break, and I realized that my working blogging environment broke and I wanted to setup again to be able to blog from both my personal laptop and any other laptop. But to my dismay, it was not that stright forward. Luckily, I had the source folder of my blog with me. It was quite a feat, Hence I thought of documenting it through this post.</p>

<!--more--> 


<h3>How Octopress works</h3>

<p>Octopress repositories have two branches, source and master. The <code>source</code> branch contains the files that are used to generate the blog and the <code>master</code> contains the blog itself.</p>

<p>When the local folders are initially configured according to the <a href="http://octopress.org/docs/setup/">Octopress Setup Guide</a>, the master branch is stored in a subfolder named ‘_deploy’. Since the folder name begins with an underscore, it is ignored when you git push origin source. Instead, the master branch (which contains your blog posts) gets updated when you rake deploy.</p>

<h3>Clone your blog to the new machine</h3>

<p>{% codeblock %}
$ git clone -b source git@github.com:username/username.github.com.git Local_octopress
$ cd Local_octopress
$ git clone git@github.com:username/username.github.com.git _deploy
$ gem install bundler
$ rbenv rehash    # If you use rbenv, rehash to be able to run the bundle command</p>

<p>$ bundle install</p>

<p>$ rake setup_github_pages</p>

<p>It will prompt you for your repository URL.
Enter the read/write url for your repository
(For example, 'git@github.com:your_username/your_username.github.com)
That’s you setup with a new local copy of your Octopress blog.</p>

<p>{% endcodeblock %}</p>

<h3>Pushing changes from two different machines</h3>

<p>{% codeblock %}
If you want to blog from more than one computer, you need to make sure that you push everything before switching computers.
From the first machine do the following whenever you’ve made changes:</p>

<p>$ rake generate
$ git add .
$ git commit -am "Some comment here."
$ git push origin source  # update the remote source branch
$ rake deploy             # update the remote master branch</p>

<p>Then on the other machine, you need to pull those changes.</p>

<p>$ cd octopress
$ git pull origin source  # update the local source branch
$ cd ./_deploy
$ git pull origin master  # update the local master branch</p>

<p>{% endcodeblock %}</p>

<h3>Octopress 2.0</h3>

<p>If you were returning to blogging after so long, chances are that there were many things <a href="https://github.com/imathis/octopress/blob/master/CHANGELOG.markdown">changed</a>.</p>

<ol>
<li>Rubypants is removed.</li>
<li>Include Code Tag lets you embed external code snippets from your file system and adds a download link</li>
<li>Pullquote Tag Generate beautiful semantic pullquotes (no double data) based on Maykel Loomans's technique</li>
<li>Category Generator gives you archive pages for each category</li>
<li>Sitemap.xml Generator for search engines</li>
</ol>


<p>etc. etc.</p>

<p>I got so many errors once I checked out a new version of Octopress. It was not supporting many of my old plugins, So I got rid of some, and I updated some.</p>

<h3>Errors</h3>

<p>One error I got was in date.rb of <a href="http://feedjira.com/">feedjira(formerly feedzira)</a> plugin.
The error message said:</p>

<p>{% codeblock %}
jekyll 2.1.1 undefined method `deep_merge'
{% endcodeblock %}</p>

<p>so I replaced deep_merge</p>

<p>{% codeblock %}
    def to_liquid
        date_format = self.site.config['date_format']
        self.data.deep_merge({
            "title"             => self.data['title'] || self.slug.split('-').select {|w| w.capitalize! || w }.join(' '),
            "url"               => self.url,
            "date"              => self.date,
            # Monkey patch
            "date_formatted"    => format_date(self.date, date_format),
            "updated_formatted" => self.data.has_key?('updated') ? format_date(self.data['updated'], date_format) : nil,
            "id"                => self.id,
            "categories"        => self.categories,
            "next"              => self.next,
            "previous"          => self.previous,
            "tags"              => self.tags,
            "content"           => self.content })
    end</p>

<p>{% endcodeblock %}</p>

<p>with the following:</p>

<p>{% codeblock %}
    def to_liquid(attrs = nil)
      date_format = self.site.config['date_format']
      new_datas = {
        "title"             => self.data['title'] || self.slug.split('-').select {|w| w.capitalize! || w }.join(' '),
        "url"               => self.url,
        "date"              => self.date,
        # Monkey patch
        "date_formatted"    => format_date(self.date, date_format),
        "updated_formatted" => self.data.has_key?('updated') ? format_date(self.data['updated'], date_format) : nil,
        "id"                => self.id,
        "categories"        => self.categories,
        "next"              => self.next,
        "previous"          => self.previous,
        "tags"              => self.tags,
        "content"           => self.content }</p>

<pre><code>  Utils.deep_merge_hashes(self.data, new_datas)
end
</code></pre>

<p>{% endcodeblock %}</p>

<p>Notice the use of deep_merge_hashes above.</p>

<p>Another error was <code>Updates were rejected because the tip of your current branch is behind</code> when I executed "bundle exec rake gen_deploy"</p>

<p>The reason is that Octopress only does a push to the <code>master</code> branch and not a pull. To resolve this, do this:</p>

<p>{% codeblock %}
$$ cd _deploy
$$ git push origin master -f   # hope this solves the problem, move to next command
$$ cd ..
$$ bundle exec rake gen_deploy
{% endcodeblock %}</p>

<p>Another error was in installing curl on windows. So I had to refer <a href="https://github.com/taf2/curb/issues/37">this</a>
And install curb manually.</p>

<p>{% codeblock %}
C:\Users\AshwaniK> gem install curb  -v '0.7.18' -- --with-curl-lib=C:\libcurl\bin --with-curl-include=C:\libcurl\include
Temporarily enhancing PATH to include DevKit...
Building native extensions with: '--with-curl-lib=C:\libcurl\bin --with-curl-include=C:\libcurl\include'
This could take a while...
Successfully installed curb-0.7.18
Installing ri documentation for curb-0.7.18
1 gem installed
{% endcodeblock %}</p>

<p>Reference Commands:
{% codeblock %}
cd octopress
bundle exec rake new_post["title"]
bundle exec rake preview
bundle exec rake generate</p>

<p>bundle exec rake deploy</p>

<p>git add .
git commit -m 'site updated'
git push origin source
{% endcodeblock %}</p>

<p>There were other errors which I somehow resolved.</p>

<p>Hope this helps someone.  I might need this again, So I am keeping a refrence.</p>

<p>Thats all folks. Chow.</p>

<p>Credits to: <br/>
1.  <a href="http://stackoverflow.com/questions/15864872/trouble-with-cloning-octopress-blog-on-other-laptops-computers-conflict-isseue">Trouble-with-cloning-octopress-blog-on-other-laptops</a>   <br/>
2.  <a href="http://blog.zerosharp.com/clone-your-octopress-to-blog-from-two-places/">Clone Your Octopress to Blog From Two Places.</a>   <br/>
3.  <a href="http://blog.mohitkanwal.com/blog/2014/03/26/blogging-with-octopress-from-2-computers/">Blogging-with-octopress-from-2-computers/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up octopress blog once you lost the working env]]></title>
    <link href="http://blog.ashwani.co.in/blog/2016-01-17/setting-up-octopress-blog-once-you-lost-the-working-env/"/>
    <updated>2016-01-17T10:01:28+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2016-01-17/setting-up-octopress-blog-once-you-lost-the-working-env</id>
    <content type="html"><![CDATA[<p>Hi Guys,</p>

<p>So recently I wanted to revisit my blog after a long long break, and I realized that my working blogging environment broke and I wanted to setup again to be able to blog from both my personal laptop and any other laptop. But to my dismay, it was not that stright forward. Luckily, I had the source folder of my blog with me. It was quite a feat, Hence I thought of documenting it through this post.</p>

<!--more--> 


<h3>How Octopress works</h3>

<p>Octopress repositories have two branches, source and master. The <code>source</code> branch contains the files that are used to generate the blog and the <code>master</code> contains the blog itself.</p>

<p>When the local folders are initially configured according to the <a href="http://octopress.org/docs/setup/">Octopress Setup Guide</a>, the master branch is stored in a subfolder named ‘_deploy’. Since the folder name begins with an underscore, it is ignored when you git push origin source. Instead, the master branch (which contains your blog posts) gets updated when you rake deploy.</p>

<h3>Clone your blog to the new machine</h3>

<p>{% codeblock %}
$ git clone -b source git@github.com:username/username.github.com.git Local_octopress
$ cd Local_octopress
$ git clone git@github.com:username/username.github.com.git _deploy
$ gem install bundler
$ rbenv rehash    # If you use rbenv, rehash to be able to run the bundle command</p>

<p>$ bundle install</p>

<p>$ rake setup_github_pages</p>

<p>It will prompt you for your repository URL.
Enter the read/write url for your repository
(For example, 'git@github.com:your_username/your_username.github.com)
That’s you setup with a new local copy of your Octopress blog.</p>

<p>{% endcodeblock %}</p>

<h3>Pushing changes from two different machines</h3>

<p>{% codeblock %}
If you want to blog from more than one computer, you need to make sure that you push everything before switching computers.
From the first machine do the following whenever you’ve made changes:</p>

<p>$ rake generate
$ git add .
$ git commit -am "Some comment here."
$ git push origin source  # update the remote source branch
$ rake deploy             # update the remote master branch</p>

<p>Then on the other machine, you need to pull those changes.</p>

<p>$ cd octopress
$ git pull origin source  # update the local source branch
$ cd ./_deploy
$ git pull origin master  # update the local master branch</p>

<p>{% endcodeblock %}</p>

<h3>Octopress 2.0</h3>

<p>If you were returning to blogging after so long, chances are that there were many things <a href="https://github.com/imathis/octopress/blob/master/CHANGELOG.markdown">changed</a>.</p>

<ol>
<li>Rubypants is removed.</li>
<li>Include Code Tag lets you embed external code snippets from your file system and adds a download link</li>
<li>Pullquote Tag Generate beautiful semantic pullquotes (no double data) based on Maykel Loomans's technique</li>
<li>Category Generator gives you archive pages for each category</li>
<li>Sitemap.xml Generator for search engines</li>
</ol>


<p>etc. etc.</p>

<p>I got so many errors once I checked out a new version of Octopress. It was not supporting many of my old plugins, So I got rid of some, and I updated some.</p>

<h3>Errors</h3>

<p>One error I got was in date.rb of <a href="http://feedjira.com/">feedjira(formerly feedzira)</a> plugin.
The error message said:</p>

<p>{% codeblock %}
jekyll 2.1.1 undefined method `deep_merge'
{% endcodeblock %}</p>

<p>so I replaced deep_merge</p>

<p>{% codeblock %}
    def to_liquid
        date_format = self.site.config['date_format']
        self.data.deep_merge({
            "title"             => self.data['title'] || self.slug.split('-').select {|w| w.capitalize! || w }.join(' '),
            "url"               => self.url,
            "date"              => self.date,
            # Monkey patch
            "date_formatted"    => format_date(self.date, date_format),
            "updated_formatted" => self.data.has_key?('updated') ? format_date(self.data['updated'], date_format) : nil,
            "id"                => self.id,
            "categories"        => self.categories,
            "next"              => self.next,
            "previous"          => self.previous,
            "tags"              => self.tags,
            "content"           => self.content })
    end</p>

<p>{% endcodeblock %}</p>

<p>with the following:</p>

<p>{% codeblock %}
    def to_liquid(attrs = nil)
      date_format = self.site.config['date_format']
      new_datas = {
        "title"             => self.data['title'] || self.slug.split('-').select {|w| w.capitalize! || w }.join(' '),
        "url"               => self.url,
        "date"              => self.date,
        # Monkey patch
        "date_formatted"    => format_date(self.date, date_format),
        "updated_formatted" => self.data.has_key?('updated') ? format_date(self.data['updated'], date_format) : nil,
        "id"                => self.id,
        "categories"        => self.categories,
        "next"              => self.next,
        "previous"          => self.previous,
        "tags"              => self.tags,
        "content"           => self.content }</p>

<pre><code>  Utils.deep_merge_hashes(self.data, new_datas)
end
</code></pre>

<p>{% endcodeblock %}</p>

<p>Notice the use of deep_merge_hashes above.</p>

<p>Another error was <code>Updates were rejected because the tip of your current branch is behind</code> when I executed "bundle exec rake gen_deploy"</p>

<p>The reason is that Octopress only does a push to the <code>master</code> branch and not a pull. To resolve this, do this:</p>

<p>{% codeblock %}
$$ cd _deploy
$$ git push origin master -f   # hope this solves the problem, move to next command
$$ cd ..
$$ bundle exec rake gen_deploy
{% endcodeblock %}</p>

<p>Another error was in installing curl on windows. So I had to refer <a href="https://github.com/taf2/curb/issues/37">this</a>
And install curb manually.</p>

<p>{% codeblock %}
C:\Users\AshwaniK> gem install curb  -v '0.7.18' -- --with-curl-lib=C:\libcurl\bin --with-curl-include=C:\libcurl\include
Temporarily enhancing PATH to include DevKit...
Building native extensions with: '--with-curl-lib=C:\libcurl\bin --with-curl-include=C:\libcurl\include'
This could take a while...
Successfully installed curb-0.7.18
Installing ri documentation for curb-0.7.18
1 gem installed
{% endcodeblock %}</p>

<p>Reference Commands:
{% codeblock %}
cd octopress
bundle exec rake new_post["title"]
bundle exec rake preview
bundle exec rake generate</p>

<p>bundle exec rake deploy</p>

<p>git add .
git commit -m 'site updated'
git push origin source
{% endcodeblock %}</p>

<p>There were other errors which I somehow resolved.</p>

<p>Hope this helps someone.  I might need this again, So I am keeping a refrence.</p>

<p>Thats all folks. Chow.</p>

<p>Credits to: <br/>
1.  <a href="http://stackoverflow.com/questions/15864872/trouble-with-cloning-octopress-blog-on-other-laptops-computers-conflict-isseue">Trouble-with-cloning-octopress-blog-on-other-laptops</a>   <br/>
2.  <a href="http://blog.zerosharp.com/clone-your-octopress-to-blog-from-two-places/">Clone Your Octopress to Blog From Two Places.</a>   <br/>
3.  <a href="http://blog.mohitkanwal.com/blog/2014/03/26/blogging-with-octopress-from-2-computers/">Blogging-with-octopress-from-2-computers/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MQTT, All you need to get started]]></title>
    <link href="http://blog.ashwani.co.in/blog/2015-03-10/mqtt-all-you-need-to-get-started/"/>
    <updated>2015-03-10T08:00:00+00:00</updated>
    <id>http://blog.ashwani.co.in/blog/2015-03-10/mqtt-all-you-need-to-get-started</id>
    <content type="html"><![CDATA[<p>So there are numerous post out there for MQTT implementation. I recently did a POC at work, and I wanted to keep a list of things I need to know if I wanted to return or do more with MQTT.
Hence this post.</p>

<h3><a href="http://mqtt.org/">MQTT</a></h3>

<p>MQTT is a machine-to-machine (M2M)/"Internet of Things" connectivity protocol. It was designed as an extremely</p>

<!--more-->  


<p>lightweight publish/subscribe messaging transport. It is useful for connections with remote locations where a small code footprint is required and/or network bandwidth is at a premium.</p>

<h4>Demo Architecture</h4>

<p><img src="/assets/MQTT_Arch.jpg" title="MQTT Architecture" alt="Cannot Display Architecture diagram, open this link /assets/MQTT_Arch.jpg" /></p>

<h2>Installing software</h2>

<h4>Installing Node.JS</h4>

<hr />

<p>Please follow the <a href="http://joshondesign.com/2013/10/23/noderpi">instructions</a> to install nodejs.
After that, install some modules using the Node Package Manager:
{% codeblock Command for node modules %}
npm install -g mqtt url request
{% endcodeblock %}
If you want to debug or auto-reload of the script, also install nodemon:
{% codeblock Command for nodemon %}
npm install -g nodemon
{% endcodeblock %}</p>

<p><br/><br/>
<br/></p>

<h4>Installing MQTT Broker - Mosquitto (or Checkout <a href="http://www.hivemq.com/how-to-get-started-with-mqtt/">HiveMQ</a>)</h4>

<hr />

<p>Source: <a href="http://jpmens.net/2013/09/01/installing-mosquitto-on-a-raspberry-pi/">http://jpmens.net/2013/09/01/installing-mosquitto-on-a-raspberry-pi/</a>
{% codeblock Commands for mosquitto %}
curl -O <a href="http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key">http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key</a>   <br/>
sudo apt-key add mosquitto-repo.gpg.key <br/>
rm mosquitto-repo.gpg.key
cd /etc/apt/sources.list.d/ <br/>
sudo curl -O <a href="http://repo.mosquitto.org/debian/mosquitto-repo.list">http://repo.mosquitto.org/debian/mosquitto-repo.list</a>
sudo apt-get update
{% endcodeblock %}</p>

<p>Now go ahead and install Mosquitto proper. There are three packages:</p>

<p>-Mosquitto is the MQTT broker (i.e. server)   <br/>
-mosquitto-clients are the command-line clients, which I recommend you install  <br/>
-python-mosquitto are the Python bindings, which I also think you should install all three packages together require about 665Kb of space, which we can easily afford even on the tiny Pi.</p>

<p>{% codeblock Commands for mosquitto and client installations %}
sudo apt-get install mosquitto mosquitto-clients python-mosquitto
{% endcodeblock %}</p>

<p>Mosquitto/'s default configuration means it is set up to not use username/password authentication and accepts all connections on port 1883. It also comes with two clients, mosquitto_pub and mosquitto_sub, the latter of which will be useful when you are debugging your applications. Running:
{% codeblock Command for subscribing %}
mosquitto_sub -t "#" -v   <br/>
{% endcodeblock %}
will dump all new messages to the broker. Remember the quotes around the topic, especially with the "#" wildcard on Unix as, unquoted or unescaped, that marks the start of a comment and would see the rest of the command discarded. If you leave that command running and, in another window, run
{% codeblock Command for publishing %}
'mosquitto_pub -t "mosquittodemo/test" -m "Hi"' <br/>
{% endcodeblock %}</p>

<p>then you should see the mosquitto_sub session list the message.</p>

<p><br />
<br /></p>

<h4>Installing MQTT Client - MQTTWarn</h4>

<hr />

<p>This program subscribes to any number of MQTT topics (which may include wildcards) and publishes received payloads to one or more notification services, including support for notifying more than one distinct service for the same message.</p>

<p>For example, you may wish to notify via e-mail and to Pushover of an alarm published as text to the MQTT topic <code>home/monitoring/+</code>.</p>

<p>Full Info <a href="http://jpmens.net/2014/02/17/introducing-mqttwarn-a-pluggable-mqtt-notifier/">here</a></p>

<h4>Requirements</h4>

<p>You'll need at least the following components:</p>

<p>-Python 2.x (tested with 2.6 and 2.7)  <br/>
-An MQTT broker (e.g. Mosquitto)   <br/>
-The Paho Python module: pip install paho-mqtt</p>

<h4>Installation</h4>

<p>-Clone <a href="https://github.com/jpmens/mqttwarn.git">this</a> repository into a fresh directory.  <br/>
{% codeblock Clone the repo %}
git clone <a href="https://github.com/jpmens/mqttwarn.git">https://github.com/jpmens/mqttwarn.git</a>
{% endcodeblock %}<br/>
-Copy mqttwarn.ini.sample to mqttwarn.ini and edit to your taste   <br/>
-Install the prerequisite Python modules for the services you want to use   <br/>
-Launch mqttwarn.py</p>

<p><br /></p>

<h3>MQTT Android Client</h3>

<hr />

<h4>Android Service</h4>

<p>The Paho Android Service is an interface to the Paho Java MQTT client library that provides a long running service for handling sending and receiving messages on behalf of Android client applications when the applications main Activity may not be running.</p>

<p>The Paho Android Service provides an asynchronous API</p>

<h4>Source:</h4>

<p><a href="http://git.eclipse.org/c/paho/org.eclipse.paho.mqtt.java.git/">http://git.eclipse.org/c/paho/org.eclipse.paho.mqtt.java.git/</a></p>

<p>Check out Paho project <a href="https://eclipse.org/paho/clients/android/">here</a></p>

<p>All you need to get started is:</p>

<p>{% codeblock Code for creating client and publishing a message %}
client = new MqttClient("tcp://ipAddressofBroker:1883", "pahomqttpublish1");  <br/>
client.connect();  <br/>
MqttMessage message = new MqttMessage();   <br/>
message.setPayload("A single message".getBytes());  <br/>
client.publish("home/monitoring/+", message);  <br/>
client.disconnect();  <br/>
{% endcodeblock %}</p>

<p><br /></p>

<h4>Test Broker Setup</h4>

<hr />

<p>To test your Broker setup you can install <a href="https://play.google.com/store/apps/details?id=at.tripwire.mqtt.client">MyMQTT</a> from google play.</p>

<p>In few days I am gonna write myself a post about Google Cloud Notification service (GCM). The easiet notification service for Android notifications.</p>

<p><br/>
That's all folks.  Have Fun.</p>

<p><br/></p>
]]></content>
  </entry>
  
</feed>
